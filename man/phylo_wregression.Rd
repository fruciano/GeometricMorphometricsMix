% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/phylo_wregr.R
\name{phylo_wregression}
\alias{phylo_wregression}
\title{Phylogenetically weighted regression}
\usage{
phylo_wregression(tree, Y, X, nsim = 1000, model = "BM", ncores = 1)
}
\arguments{
\item{tree}{An object of class `phylo` (from the `ape` package).}

\item{Y}{A numeric vector, matrix, or data.frame of response variables
(rows correspond to tips in `tree`).}

\item{X}{A numeric vector or factor of predictor values (length must match
number of tips).}

\item{nsim}{Integer; number of parametric simulations to perform. If 0,
only the observed phylogenetic-weighted regression is returned. Default
is 1000.}

\item{model}{Character; evolutionary model used for simulation. Passed to
the PGLS simulation routine (e.g. "BM").}

\item{ncores}{Integer; number of cores to use for simulations. Default is 1.}
}
\value{
If `nsim == 0`, returns an object of class `phylo_wregr_fit`
 containing at least elements `tree`, `intercepts`, `coefficients`, and
  `weights`.

If `nsim > 0`, returns a named list comprising the object of class `phylo_wregr_fit` described above
and additional components including:
\describe{
  \item{tree}{The input phylogenetic tree.}
  \item{PGLS_model_fit}{The fitted PGLS model used to generate simulations.}
  \item{Simulated_coefficients}{A list (or matrix for univariate Y) of simulated
    phylogenetic-weighted regression coefficients, one element per simulation.}
  \item{comparisons_with_simulations}{A data.frame with, for multivariate data,
    observed angles and summaries (min, max, one-sided 95\% confidence interval) from simulations,
    plus logical columns indicating exceedance of simulation-based thresholds or a
    critical angle. For univariate data, the structure is similar but it focuses on
    comparing coefficients to simulations (and the 95\% confidence interval is two-sided).}
}
}
\description{
Fit a phylogenetic-weighted regression for each tip of a phylogeny
(for both univariate and multivariate dependent variables)and,
optionally, perform parametric simulations under a PGLS model to evaluate
whether observed tip-level coefficients differ from expectations under
the PGLS model fitted across the whole tree.
}
\details{
This is the primary user-facing function in this source file. It returns
either the observed phylogenetic weighted regression fit (an internal
`phylo_wregr_fit` object) or, when `nsim > 0`, a list that contains the
fitted PGLS model, simulated phylogenetic-weighted regression coefficients and
summaries comparing observed and simulated coefficients


The function for the case where nsim>0 relies on `mvMORPH` and, in case of univariate data,
 `phylolm` (which should, therefore, be installed)
}
\note{
This function may give problems (NA in the output)
in the case of a single species sister to all the rest of the taxa
(this is due to the fact that all the phylogenetic correlations with
other taxa, on which the weighting is base, would be 0)
}
\examples{
# Simulate a tree and traits
library(phytools)
library(mvMORPH)

set.seed(123)

tree = pbtree(n=30)
plot(tree)
# Generate a tre with 30 tips

Sigma=diag(6)
Sigma[1,2]=Sigma[2,1]=0.5
Data_sim=mvSIM(tree=tree, nsim=1, model="BM1", param=list(sigma=Sigma))
# Generate data under Brownian motion
# with the first two variables exibiting a weak correlation
Y = Data_sim[,2:6]
X = Data_sim[,1]
# Split the data in dependent variables and predictor

# manova.gls(mvgls(Y~X, tree=tree, model="BM"), nperm=100)
# We could test the significance of a PGLS model
# uncommenting the line above

result = phylo_wregression(tree, Y, X, nsim=100)
names(result)

# Plot a PCA of coefficients with superimposed the phylogeny
# (a so called "phylomorphospace" plot)
plot(result)

# Plot coefficients without phylogeny
plot(result, plot_phylogeny = FALSE)

# Single trait example
Y_single = rnorm(20)
result_single = phylo_wregression(tree, Y_single, X, nsim=100)
plot(result_single)


}
\seealso{
\code{\link{plot.phylo_wregr_fit}} for plotting the results
}
