% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/disparity_resample.R
\name{disparity_resample}
\alias{disparity_resample}
\title{Resampling-based estimates (bootstrap or rarefaction) of disparity / morphospace occupation}
\usage{
disparity_resample(
  Data,
  group = NULL,
  n_resamples = 1000,
  statistic = "multivariate_variance",
  CI = 0.95,
  bootstrap_rarefaction = "bootstrap",
  sample_size = NULL
)
}
\arguments{
\item{Data}{A data frame, matrix, vector, or 3D array. Observations (specimens) must be in rows
(if a 3D array is supplied, the third dimension is assumed to index specimens).}

\item{group}{A factor or a vector indicating group membership (will be coerced to factor). If
`NULL` (default) a single analysis is performed on the full dataset.}

\item{n_resamples}{Number of resampling replicates (default 1000).}

\item{statistic}{Character string identifying the statistic to compute. One of
`"multivariate_variance"`, `"mean_pairwise_euclidean_distance"`, `"convex_hull_volume"`,
`"claramunt_proper_variance"`. Default is
`"multivariate_variance"`. Ignored for univariate data (vector input).}

\item{CI}{Desired two-sided confidence interval level (default 0.95) used for percentile
confidence intervals.}

\item{bootstrap_rarefaction}{Either `"bootstrap"` (default) for resampling with replacement or
`"rarefaction"` for resampling without replacement.}

\item{sample_size}{Either `NULL` (default), a positive integer indicating the number of rows to
sample without replacement when `bootstrap_rarefaction=="rarefaction"`, or the character
`"smallest"` to use the size of the smallest group (all groups rarefied to that size). If
`"smallest"` is supplied but no groups are defined, an error is returned. Required (not `NULL`)
when `bootstrap_rarefaction=="rarefaction"`.}
}
\value{
A list containing:
 \describe{
   \item{chosen_statistic}{Character vector of length 1 with the human-readable name of the statistic used.}
   \item{results}{A data frame with columns `group`, `observed`, `CI_min`, `CI_max`. One row per group.}
   \item{resampled_values}{If a single group: numeric vector of length `n_resamples` with the resampled values.
     If multiple groups: a named list with one numeric vector (length `n_resamples`) per group.}
}
}
\description{
Provides a unified interface to obtain resampled (bootstrap or rarefied)
estimates of several commonly used disparity / morphospace occupation statistics.
}
\details{
The function allows choosing among the following multivariate statistics:
\itemize{
 \item Multivariate variance (trace of the covariance matrix; sum of variances)
 \item Mean pairwise Euclidean distance
 \item Convex hull volume (n-dimensional)
 \item Claramunt proper variance (Claramunt 2010) based on a linear shrinkage covariance matrix
}

If the input `Data` is univariate (i.e., a vector), the analysis defaults to computing
the (univariate) variance within each group (the attribute `statistic` is ignored).

If `bootstrap_rarefaction=="bootstrap"`, the function performs resampling with replacement
(i.e., classical bootstrap) by sampling rows of the data matrix / data frame.

If `bootstrap_rarefaction=="rarefaction"`, the function performs resampling without replacement
at the sample size indicated in `sample_size` (numeric) or, if `sample_size=="smallest"`,
at the size of the smallest group (all groups are resampled to that size).
Rarefaction requires specifying a valute to the attribute `sample_size`; an error is returned otherwise.
}
\section{Observed estimate}{

For bootstrap resampling the observed estimate reported is the statistic computed on the
original (non-resampled) data for each group. For rarefaction, because the purpose is to make
groups comparable at a common (smaller) sample size, the observed estimate reported is the
mean of the rarefied resampled values for that group (i.e., the mean across all rarefaction
replicates).
}

\section{Input data types}{

`Data` can be a data frame, a matrix, a vector, or a 3D array of landmark coordinates
(e.g., p landmarks x k dimensions x n specimens). In the latter case, the array is converted
internally to a 2D matrix with specimens in rows and (landmark * dimension) variables in columns.
}

\examples{
set.seed(123)
# Simulate two groups with different means but same covariance
if (requireNamespace("MASS", quietly = TRUE)) {
  X1 = MASS::mvrnorm(20, mu=rep(0, 10), Sigma=diag(10))
  X2 = MASS::mvrnorm(35, mu=rep(2, 10), Sigma=diag(10))
  Data = rbind(X1, X2)
  grp = factor(c(rep("A", nrow(X1)), rep("B", nrow(X2))))

  # Bootstrap multivariate variance
  boot_res = disparity_resample(Data, group=grp, n_resamples=200,
                                statistic="multivariate_variance",
                                bootstrap_rarefaction="bootstrap")
  boot_res$results

  # Rarefaction (to the smallest group size) of mean pairwise Euclidean distance
  rar_res = disparity_resample(Data, group=grp, n_resamples=200,
                               statistic="mean_pairwise_euclidean_distance",
                               bootstrap_rarefaction="rarefaction", sample_size="smallest")
  rar_res$results
}

}
\references{
Drake AG, Klingenberg CP. 2010. Large-scale diversification of skull shape in domestic dogs: disparity and modularity. American Naturalist 175:289-301.

Claramunt S. 2010. Discovering exceptional diversifications at continental scales: the case of the endemic families of Neotropical Suboscine passerines. Evolution 64:2004-2019.

Fruciano C, Pappalardo AM, Tigano C, Ferrito V. 2014. Phylogeographical relationships of Sicilian brown trout and the effects of genetic introgression on morphospace occupation. Biological Journal of the Linnean Society 112:387-398.
}
\seealso{
\code{\link{rarefied_disparity}}, \code{\link{rarefied_convex_hull}}, \code{\link{disparity_test}}
}
